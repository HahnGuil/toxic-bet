openapi: 3.0.3
info:
  title: toxic-bet
  description: <h3>Documentation for the Toxic-bet API endpoints.<h3>
  contact:
    name: Guilherme Hahn
    email: guilherme.f.h@hotmail.com
  version: latest
tags:
  - name: users
    description: Operations for uses
  - name: team
    description: Operations for teams
  - name: match
    description: Operations for matches
  - name: bet
    description: Operations for bets
  - name: betting_pool
    description: Operations for beatings pool
  - name: standings
    description: Operations for standings

paths:
  /users:
    post:
      tags:
        - users
      summary: Operation to register users in the toxic-bet application.
      description: After successfully logging into the authentication server, the user receives an email to register in the application.
      operationId: postRegisterUser
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRequestDTO'
      responses:
        '201':
          description: User successfully registered.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponseDTO'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
  /match:
    get:
      summary: Reactive stream of matches (SSE)
      description: Returns all existing matches and new creations of Server-Sent Events.
      operationId: streamAllMatches
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Stream of matches (text/event-stream)
          content:
            text/event-stream:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MatchResponseDTO'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
              examples:
                missingToken:
                  summary: Missing authentication token
                  value:
                    timestamp: "2024-12-08T19:30:00Z"
                    message: "Authentication token is required."
                invalidToken:
                  summary: Invalid or malformed token
                  value:
                    timestamp: "2024-12-08T19:30:00Z"
                    message: "Invalid authentication token."
                expiredToken:
                  summary: Expired token
                  value:
                    timestamp: "2024-12-08T19:30:00Z"
                    message: "Authentication token has expired."
                authenticationFailed:
                  summary: Authentication server connection failed
                  value:
                    timestamp: "2024-12-08T19:30:00Z"
                    message: "Unable to authenticate. Please try again later."
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
  /scores:
    get:
      summary: Operation to retrieve the results of ongoing matches.
      description: This operation will bring every second the updated result of the matches that have the result = IN_PROGRESS, informing the match ID, the names of the participating teams and the score separately.
      operationId: getStreamScores
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Stream of matches (text/event-stream)
          content:
            text/event-stream:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MatchResponseDTO'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
              examples:
                missingToken:
                  summary: Missing authentication token
                  value:
                    timestamp: "2024-12-08T19:30:00Z"
                    message: "Authentication token is required."
                invalidToken:
                  summary: Invalid or malformed token
                  value:
                    timestamp: "2024-12-08T19:30:00Z"
                    message: "Invalid authentication token."
                expiredToken:
                  summary: Expired token
                  value:
                    timestamp: "2024-12-08T19:30:00Z"
                    message: "Authentication token has expired."
                authenticationFailed:
                  summary: Authentication server connection failed
                  value:
                    timestamp: "2024-12-08T19:30:00Z"
                    message: "Unable to authenticate. Please try again later."
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
  /create:
    post:
      tags:
        - match
      summary: Operation for registering matches
      description: It is necessary to register the matches automatically. To do this, you need to consult the table of team relationships to find the IDs. A match must have home team, away team, result set to NOT_STARTED, and the start time.
      operationId: postCreateMatch
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MatchRequestDTO'
      responses:
        '201':
          description: Match successfully registered.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchResponseDTO'
        '401':
          description: Unauthorized
        '404':
          description: Not Found
        '422':
          description: Matchmaking is not allowed.
  /{matchId}/score:
    patch:
      tags:
        - match
      summary: Update match score
      description: Updates the score of an ongoing match
      operationId: patchUpdateMatchScore
      security:
        - bearerAuth: []
      parameters:
        - name: matchId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateScoreRequestDTO'
      responses:
        '200':
          description: Score successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchResponseDTO'
        '404':
          description: Match not found
        '422':
          description: Cannot update score for finished match
components:
  schemas:
    ErrorResponseDTO:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
          description: Timestamp when the error occurred
          example: "2024-01-15T10:30:00Z"
        message:
          type: string
          description: Error message description
          example: "Unauthorized access"
    SuccessResponseDTO:
      type: object
      properties:
        message:
          type: string
          description: Success message description
          example: "Success created the operation"
    MatchRequestDTO:
      type: object
      required:
        - homeTeamId
        - visitingTeamId
        - matchTime
      properties:
        homeTeamId:
          type: integer
          format: int64
          description: Home team ID (Long)
          example: 1
        visitingTeamId:
          type: integer
          format: int64
          description: Visiting team ID (Long)
          example: 2
        matchTime:
          type: string
          description: Date and time of the match in the format DD/MM/YYYY HH:MM
          pattern: "^(0[1-9]|[12][0-9]|3[01])/(0[1-9]|1[0-2])/[0-9]{4} ([01][0-9]|2[0-3]):[0-5][0-9]$"
          example: "21/12/2025 18:30"
    MatchResponseDTO:
      type: object
      properties:
        matchId:
          type: integer
          format: int64
          description: Match id (Long)
          example: 1
        homeTeamName:
          type: string
          description: Name of home team
          example: "Brasil"
        homeTeamScore:
          type: integer
          description: Score of the home team
          example: 1
        visitingTeamName:
          type: string
          description: Name of visiting team
          example: "USA"
        visitingTeamScore:
          type: integer
          description: Score of the visiting team
          example: 1
        matchTime:
          type: string
          description: Date em time of match DD/MM/YYYY HH:MM
          example: "21/12/2025 18:30"
        result:
          type: string
          enum: [ NOT_STARTED, HOME_WIN, VISITING_WIN, DRAW, IN_PROGRESS ]
          description: Match result
          example: "NOT_STARTED"
    UserRequestDTO:
      type: object
      required:
        - name
        - email
      properties:
        email:
          type: string
          format: email
          description: User email address to be registered
          example: usuario@exemplo.com
        name:
          type: string
          description: User name to be registered
          example: John Coffee
    UserResponseDTO:
      type: object
      properties:
        message:
          type: string
          example: User successfully registered
    UpdateScoreRequestDTO:
      type: object
      required:
        - homeTeamScore
        - visitingTeamScore
      properties:
        homeTeamScore:
          type: integer
          minimum: 0
          description: Score of the home team
          example: 2
        visitingTeamScore:
          type: integer
          minimum: 0
          description: Score of the visiting team
          example: 1
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token generated by the authentication server to be validated in the application.
security:
  - bearerAuth: []
